<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>University of Kasi Portal - User Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: url('https://images.unsplash.com/photo-1524995997946-a1c2e315a42f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1400&q=80') no-repeat center center/cover;
      color: #fff;
      display: flex;
      height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background: rgba(0,0,0,0.8);
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: width 0.3s ease;
    }
    .sidebar.collapsed { width: 80px; }
    .sidebar .toggle-btn { align-self: flex-end; cursor: pointer; font-size: 20px; margin-bottom: 20px; }
    .sidebar .logo { text-align: center; margin-bottom: 30px; }
    .sidebar .logo i { font-size: 50px; margin-bottom: 10px; }
    .sidebar h2 { margin: 0; font-size: 22px; white-space: nowrap; }

    .nav-btn {
      width: 100%;
      background: #f4d03f;
      color: #000;
      border: none;
      padding: 12px;
      margin: 10px 0;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    .nav-btn:hover { background: #d4ac0d; }

    /* Content */
    .content { flex: 1; padding: 20px; overflow-y: auto; }
    .hero { text-align: center; padding: 80px 20px; background: rgba(0,0,0,0.6); border-radius: 12px; margin: 20px 0; }
    .hero h2 { font-size: 32px; margin-bottom: 15px; }
    .btn { background: #f4d03f; color: #000 !important; padding: 10px 18px; border-radius: 6px; font-weight: bold; text-decoration: none; transition: background 0.3s; cursor: pointer; }
    .btn:hover { background: #d4ac0d; }
    .section { background: rgba(0,0,0,0.6); padding: 40px 20px; margin: 20px 0; border-radius: 10px; }

    .form-container { max-width: 600px; margin: 20px auto; background: rgba(255,255,255,0.1); padding: 30px; border-radius: 12px; text-align: left; }
    .form-container h2 { text-align: center; margin-bottom: 20px; color: #f4d03f; }
    .form-container input, .form-container select, .form-container textarea {
      width: 100%; padding: 10px; margin: 10px 0; border-radius: 6px; border: none; font-size: 14px;
    }
    .form-container button { width: 100%; padding: 12px; margin-top: 10px; background: #f4d03f; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }
    .form-container button:hover { background: #d4ac0d; }

    table { width: 100%; border-collapse: collapse; color: #fff; margin-top: 20px; }
    th, td { padding: 12px; border-bottom: 1px solid #f4d03f; text-align: left; }
    th { background: rgba(255,255,255,0.1); }
    tr:hover { background: rgba(255,255,255,0.05); }

    footer { text-align: center; padding: 15px; background: rgba(0,0,0,0.7); border-radius: 10px; margin-top: 20px; }

    /* Filters / reports */
    .panel { background: rgba(255,255,255,0.1); border-radius: 8px; padding: 16px; margin-top: 20px; }
    .panel h2 { margin-top: 0; font-size: 1.3rem; color: #f4d03f; }
    .filter-group { margin-bottom: 14px; text-align: left; }
    .filter-group strong { display: block; margin-bottom: 4px; }
    .filter-group label { margin-left: 8px; display: block; }

  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="toggle-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></div>
    <div class="logo"><i class="fas fa-university"></i><h2 id="logo-text">UOK Portal</h2></div>
    <button class="nav-btn" onclick="showSection('home')"><i class="fas fa-home"></i> <span class="btn-text">Home</span></button>
    <button class="nav-btn" onclick="showSection('profile')"><i class="fas fa-user"></i> <span class="btn-text">Profile</span></button>
    <button class="nav-btn" onclick="showSection('bookings')"><i class="fas fa-calendar-check"></i> <span class="btn-text">Bookings</span></button>
    <button class="nav-btn" onclick="showSection('notices')"><i class="fas fa-bell"></i> <span class="btn-text">Notices</span></button>
    <button class="nav-btn" onclick="showSection('report')"><i class="fas fa-file-alt"></i> <span class="btn-text">Reports</span></button>
  </div>

  <!-- Content -->
  <div class="content">
    <!-- Home -->
    <section class="hero" id="home-section">
      <h2>Welcome, {{ user.full_name }}</h2>
      <p>Email: {{ user.email }} | Faculty: {{ user.faculty }}</p>
    </section>

    <!-- Profile -->
    <section class="section" id="profile-section" style="display:none;">
      <div class="form-container">
        <h2>Update Profile</h2>
        <form id="profileForm">
          <input type="text" id="profileFname" placeholder="First Name" value="{{ user.fname }}" required>
          <input type="text" id="profileLname" placeholder="Last Name" value="{{ user.lname }}" required>
          <input type="email" id="profileEmail" placeholder="Email" value="{{ user.email }}" required>
          <select id="profileFaculty" required>
            <option value="">Select Faculty</option>
            <option value="Engineering" {% if user.faculty=='Engineering' %}selected{% endif %}>Engineering</option>
            <option value="Economics & Management Sciences (EMS)" {% if user.faculty=='Economics & Management Sciences (EMS)' %}selected{% endif %}>Economics & Management Sciences (EMS)</option>
            <option value="Health Sciences" {% if user.faculty=='Health Sciences' %}selected{% endif %}>Health Sciences</option>
            <option value="Law" {% if user.faculty=='Law' %}selected{% endif %}>Law</option>
            <option value="Humanities & Education" {% if user.faculty=='Humanities & Education' %}selected{% endif %}>Humanities & Education</option>
            <option value="Natural & Physical Sciences" {% if user.faculty=='Natural & Physical Sciences' %}selected{% endif %}>Natural & Physical Sciences</option>
          </select>
          <button type="submit">Update Profile</button>
        </form>
      </div>
    </section>

    <!-- Bookings -->
    <section class="section" id="bookings-section" style="display:none;">
      <div class="form-container">
        <h2>Your Bookings</h2>
        <a href="booking.html" class="btn">Create New Booking</a>
        <table>
          <thead>
            <tr><th>ID</th><th>First</th><th>Last</th><th>Faculty</th><th>Service</th><th>Slot</th><th>Actions</th></tr>
          </thead>
          <tbody id="bookingTable">
            {% for booking in bookings %}
            <tr>
              <td>{{ booking.id }}</td>
              <td>{{ booking.fname }}</td>
              <td>{{ booking.lname }}</td>
              <td>{{ booking.faculty }}</td>
              <td>{{ booking.service }}</td>
              <td>{{ booking.slot }}</td>
              <td>
                <a href="booking.html?id={{ booking.id }}" class="btn">Update</a>
                <button onclick="deleteBooking({{ booking.id }})" class="btn">Delete</button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </section>

    <!-- Notices -->
    <section class="section" id="notices-section" style="display:none;">
      <div class="form-container">
        <h2>Your Notices</h2>
        <form id="noticeForm">
          <input type="hidden" id="noticeId">
          <textarea id="noticeMessage" placeholder="Enter your notice" required></textarea>
          <button type="submit">Save Notice</button>
        </form>
        <table>
          <thead><tr><th>ID</th><th>Message</th><th>Actions</th></tr></thead>
          <tbody id="noticeTable">
            {% for notice in notices %}
            <tr>
              <td>{{ notice.id }}</td>
              <td>{{ notice.message }}</td>
              <td>
                <button onclick="editNotice({{ notice.id }}, '{{ notice.message }}')" class="btn">Update</button>
                <button onclick="deleteNotice({{ notice.id }})" class="btn">Delete</button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </section>

    <!-- Reports -->
    <section class="section" id="report-section" style="display:none;">
      <div class="panel">
        <h2>Student Analytics Report</h2>
        <form method="POST" action="{{ url_for('records') }}">
          <div class="filter-group">
            <strong>Report Type</strong>
            <label><input type="radio" name="report_type" value="booking" checked> Booking Report</label>
            <label><input type="radio" name="report_type" value="query"> Query Report</label>
            <label><input type="radio" name="report_type" value="employees"> Employees</label>
            <label><input type="radio" name="report_type" value="students"> Students</label>
          </div>
          <div class="filter-group">
            <strong>Service Category</strong>
            <label><input type="checkbox" name="service_category" value="counselling"> Student support and counselling</label>
            <label><input type="checkbox" name="service_category" value="consultations"> Lecture Consultations</label>
            <label><input type="checkbox" name="service_category" value="library"> Library</label>
            <label><input type="checkbox" name="service_category" value="it"> IT Support</label>
            <label><input type="checkbox" name="service_category" value="administrative"> Administrative</label>
          </div>
          <div class="filter-group">
            <strong>Sort</strong>
            <label><input type="checkbox" name="sort" value="alphabetical" checked> Alphabetical order</label>
            <label><input type="checkbox" name="sort" value="date"> Date</label>
          </div>
          <button type="submit" class="btn">Request Report</button>
        </form>
      </div>
    </section>

    <footer>&copy; 2025 University of Kasi. All Rights Reserved.</footer>
  </div>

  <script>
    // Sidebar toggle
    function toggleSidebar() {
      const sidebar = document.getElementById("sidebar");
      sidebar.classList.toggle("collapsed");
      const text = document.querySelectorAll(".btn-text, #logo-text");
      text.forEach(el => el.style.display = sidebar.classList.contains("collapsed") ? "none" : "inline");
    }

    // Section switch
    function showSection(section) {
      const allSections = document.querySelectorAll('.hero, .section');
      allSections.forEach(s => s.style.display = 'none');
      if(section === 'home') document.getElementById('home-section').style.display = 'block';
      else document.getElementById(section+'-section').style.display = 'block';
    }

    document.addEventListener("DOMContentLoaded", () => { showSection('home'); });

    // Profile update demo
    document.getElementById("profileForm").addEventListener("submit", e=>{
      e.preventDefault();
      alert("Profile updated successfully!");
    });

    // Bookings delete
    function deleteBooking(id){
      if(confirm("Delete this booking?")){
        const rows = document.querySelectorAll("#bookingTable tr");
        rows.forEach(r => { if(r.children[0].textContent == id) r.remove(); });
      }
    }

    // Notices CRUD demo
    let noticeCounter = {{ notices|length + 1 }};
    const noticeForm = document.getElementById("noticeForm");
    noticeForm.addEventListener("submit", e=>{
      e.preventDefault();
      const id = document.getElementById("noticeId").value || noticeCounter++;
      const msg = document.getElementById("noticeMessage").value;
      const tbody = document.getElementById("noticeTable");
      const row = document.createElement("tr");
      row.innerHTML = `<td>${id}</td><td>${msg}</td>
        <td>
          <button onclick="editNotice(${id}, '${msg}')" class="btn">Update</button>
          <button onclick="deleteNotice(${id})" class="btn">Delete</button>
        </td>`;
      tbody.appendChild(row);
      noticeForm.reset();
      document.getElementById("noticeId").value = '';
    });
    function editNotice(id,msg){
      document.getElementById("noticeId").value = id;
      document.getElementById("noticeMessage").value = msg;
    }
    function deleteNotice(id){
      if(confirm("Delete this notice?")){
        const rows = document.querySelectorAll("#noticeTable tr");
        rows.forEach(r => { if(r.children[0].textContent == id) r.remove(); });
      }
    }
  </script>
</body>
</html>
